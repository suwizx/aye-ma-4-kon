<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubuntu Server Monitoring</title>
    <!-- Import Google Font: Ubuntu -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <!-- Link to your stylesheet -->
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
</head>
<body>
    <div class="flex items-center flex-col w-full h-screen p-6">
	<div class="p-4 w-md bg-zinc-50 border border-zinc-200 rounded-lg flex-1 max-w-full flex flex-col gap-6 ">
		<span class="font-bold uppercase text-2xl flex items-center gap-2">
			<i class="bi bi-database"></i>
			Suwizx Server
			<span class="text-sm bg-green-50 text-green-500 border border-green-500 rounded-full px-2">uptime <span id="uptime">no data</span></span>
		</span>
		<p class="text-sm text-gray-600">last update : <span id="lastupdate">loading...</span></p>
		<div class="p-4 w-full py-10 rounded-lg flex-col flex gap-4 items-center bg-white border border-zinc-200">
			<h2 class="text-2xl font-bold flex items-center gap-2">
				<i class="bi bi-pci-card-network"></i>
				 Network
			</h2>
			<div class="flex flex-col gap-2">
				<h3 class="text-lg font-medium flex items-center gap-2"><i class="bi bi-ethernet"></i> LAN IP <span id="lanip">1.1.1.1</span></h3>
				<h3 class="text-lg font-medium flex items-center gap-2"><i class="bi bi-wifi"></i>INTERNET IP <span id="internetip">1.1.1.1</span></h3>	
			</div>
		</div>
		<div class="w-full p-10 rounded-lg flex-col flex gap-4 items-center bg-white border border-zinc-200">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                                <i class="bi bi-cpu-fill"></i> 
				Cpu Usage
                        </h2>
                        <div class="flex items-center gap-2 w-full">
                        	<div class="w-full bg-zinc-200 rounded-full overflow-hidden flex-1">
						<div id="cpuprog" class="h-3 bg-pink-300 w-15"></div>
				</div>
				<p style="cpuuse" class="w-18 text-end flex justify-center items-center">0%</p>
			</div>
                </div>
		<div class="w-full p-10 rounded-lg flex-col flex gap-4 items-center bg-white border border-zinc-200">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
				<i class="bi bi-memory"></i>
                                Memory Usage
                        </h2>
                        <div class="flex items-center gap-2 w-full">
                                <div class="w-full bg-zinc-200 rounded-full overflow-hidden flex-1">
                                                <div id="memprog" class="h-3 bg-pink-300 w-15"></div>
                                </div>
                                <p class="w-18 text-end flex justify-center items-center"><span id="memuse">1MB</span> / <span id="memtotal">1MB</span></p>
                        </div>
                </div>
		 <div class="w-full p-10 rounded-lg flex-col flex gap-4 items-center bg-white border border-zinc-200">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
				<i class="bi bi-device-hdd-fill"></i>
                                Storage Usage
                        </h2>
                        <div class="flex items-center gap-2 w-full">
                                <div class="w-full bg-zinc-200 rounded-full overflow-hidden flex-1">
                                                <div id="storprog" class="h-3 bg-pink-300 w-15"></div>
                                </div>
                                <p class="w-18 text-end flex justify-center items-center"><span id="storuse">1MB</span> / <span id="stortotal">1MB</span></p>
                        </div>
                </div>


	</div>
            
    </div>
	<script>
	async function fetchServerStats() {
 	   try {
       		 const response = await fetch("./data.json");
       		 if (!response.ok) {
           		 throw new Error(`HTTP error! status: ${response.status}`);
       		 }
       		 const data = await response.json();
       		 return data;
   	 } catch (error) {
       		 console.error('Error fetching server stats:', error);
       		 return null;
   	 	}
	}
	
	function calculateTotalMemory(memory) {
    		const parseMemory = (str) => {
        	const value = parseFloat(str);
       		 const unit = str.replace(/[0-9.]/g, '');
        
        		if (unit === 'Gi') return value * 1024;
        		if (unit === 'Mi') return value;
        		if (unit === 'G') return value * 1024;
        		if (unit === 'M') return value;
        		return value;
    		};
    
    		const used = parseMemory(memory.used);
    		const free = parseMemory(memory.free);
    		const available = parseMemory(memory.available);
    
    		const totalFree = available + free;
    		const total = used + totalFree;
    
   	 	return {
        		used: memory.used,
        		total: `${(total / 1024).toFixed(1)}Gi`,
        		usedMB: used,
        		totalMB: total
    		};
	}

	function updateUI(data) {
   		 if (!data) {
       			 console.error('No data to update UI');
       			 return;
   		 }
    
    		document.getElementById('lastupdate').textContent = data.last_updated;
    
    		document.getElementById('uptime').textContent = data.uptime;
    
    		const cpuUsage = parseFloat(data.cpu_usage);
    		document.getElementById('cpuprog').style.width = `${cpuUsage}%`;
    		document.querySelector('[style="cpuuse"]').textContent = data.cpu_usage;
    
    		const memoryInfo = calculateTotalMemory(data.memory);
    		const memoryPercent = (memoryInfo.usedMB / memoryInfo.totalMB) * 100;
    		document.getElementById('memprog').style.width = `${memoryPercent}%`;
    		document.getElementById('memuse').textContent = memoryInfo.used;
    		document.getElementById('memtotal').textContent = memoryInfo.total;
    
    		const storageUsed = parseFloat(data.disk.usage);
    		const storageTotal = parseFloat(data.disk.all);
    		const storagePercent = (storageUsed / storageTotal) * 100;
    		document.getElementById('storprog').style.width = `${storagePercent}%`;
    		document.getElementById('storuse').textContent = data.disk.usage;
    		document.getElementById('stortotal').textContent = data.disk.all;
    
   		 if (data.lan_ip) {
        		document.getElementById('lanip').textContent = data.lan_ip;
    		}
    		if (data.internet_ip) {
        		document.getElementById('internetip').textContent = data.internet_ip;
    		}	
	}

	async function initMonitoring() {
 		const data = await fetchServerStats();
    		updateUI(data);
    
    		setInterval(async () => {
        		const data = await fetchServerStats();
        		updateUI(data);
    		}, 5000);
	}
	</script>
</body>
</html>
