<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>67070019's server</title>
    <!-- Import Google Font: Ubuntu -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <!-- Link to your stylesheet -->
    <link rel="stylesheet" href="019style.css">
</head>
<body>
    <div class="container">
        <h1>67070019's Server<h1>
 
	 <div class="sub-container-1">
            <div class="txt-update">
		STATUS TRACKING
            </div>
         </div>

    <div class="container-2">
        <div class="mid-container-l"> 
            <div class="sub-container"> 
                <div class="card">
                    <!-- -->
                    <div  class="card-name">
                        CPU USAGE
                    </div>
                    <div class="card-info" id="item.cpu">
                        <h2>0.0%</h2>
                        <div class="progress">
                                <div class="progress-fill" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
            </div>

       
            <div class="sub-container"> 
                <div class="card">
                    <!-- -->
                    <div  class="card-name">
                        MEMORY USAGE
                    </div>
                    <div class="card-info" id="item.memory">
                        <h2>0.0%</h2>
                        <div class="progress">
                                <div class="progress-fill" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
            </div>

       
            <div class="sub-container"> 
                <div class="card">
                    <!-- -->
                    <div  class="card-name">
                        STORAGE USAGE
                    </div>
                    <div class="card-info" id="item.storage">
                        <h2>0.0%</h2>
                        <div class="progress">
                                <div class="progress-fill" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
            </div>


        </div>


        <div class="mid-container-r"> 

            
            <div class="sub-container"> 
                <div class="card">
                    <!-- -->
                    <div  class="card-name">
                        LAN IP
                    </div>
                    <div class="card-info" id="lan-value">
                        -----
                    </div>
                </div>
            </div>

            <div class="sub-container"> 
                <div class="card">
                    <!-- -->
                    <div  class="card-name">
                        LOCAL IP
                    </div>
                    <div class="card-info" id="local-value">
                        -----
                    </div>
                </div>
            </div>

       
   </div>
    </div>


	 <div class="sub-container-1">
            <div class="txt-update" id="lastupdate">
		        -----
            </div>
        </div>

      </div>

    <script>
        function updateProgress(selector, percent) {
            const bar = document.querySelector(selector);
            if (bar) {
                bar.style.width = percent + '%';
            }
        }

        async function fetchServerStats() {
            try {
                const response = await fetch("./data.json");
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching server stats:', error);
                return null;
            }
        }

        function calculateTotalMemory(memory) {
            const parseMemory = (str) => {
                const value = parseFloat(str);
                const unit = str.replace(/[0-9.]/g, '');

                if (unit === 'Gi') return value * 1024;
                if (unit === 'Mi') return value;
                if (unit === 'G') return value * 1024;
                if (unit === 'M') return value;
                return value;
            };

            const used = parseMemory(memory.used);
            const free = parseMemory(memory.free);
            const available = parseMemory(memory.available);

            const totalFree = available + free;
            const total = used + totalFree;

            return {
                used: memory.used,
                total: `${(total / 1024).toFixed(1)}Gi`,
                usedMB: used,
                totalMB: total
            };
        }

        function updateUI(data) {
            if (!data) {
                console.error('No data to update UI');
                return;
            }

            // Update last update time
            const lastUpdateEl = document.getElementById('lastupdate');
            if (lastUpdateEl) {
                lastUpdateEl.textContent = data.last_updated || 'N/A';
            }

            // Update CPU usage
            const cpuUsage = parseFloat(data.cpu_usage);
            const cpuItem = document.getElementById('item.cpu');
            if (cpuItem) {
                const cpuValue = cpuItem.querySelector('h2');
                const cpuProgress = cpuItem.querySelector('.progress-fill');
                if (cpuValue) {
                    cpuValue.textContent = !isNaN(cpuUsage) ? `${cpuUsage.toFixed(2)}%` : 'N/A';
                }
                if (cpuProgress && !isNaN(cpuUsage)) {
                    cpuProgress.style.width = `${cpuUsage}%`;
                }
            }

            // Update Memory usage
            if (data.memory && data.memory.used && data.memory.free && data.memory.available) {
                const memoryInfo = calculateTotalMemory(data.memory);
                const memoryPercent = (memoryInfo.usedMB / memoryInfo.totalMB) * 100;
                const memoryItem = document.getElementById('item.memory');
                if (memoryItem) {
                    const memoryValue = memoryItem.querySelector('h2');
                    const memoryProgress = memoryItem.querySelector('.progress-fill');
                    if (memoryValue && !isNaN(memoryPercent)) {
                        memoryValue.textContent = `${memoryPercent.toFixed(2)}%`;
                    }
                    if (memoryProgress && !isNaN(memoryPercent)) {
                        memoryProgress.style.width = `${memoryPercent}%`;
                    }
                }
            }

            // Update Storage usage
            const storageUsed = parseFloat(data.disk.usage);
            const storageTotal = parseFloat(data.disk.all);
            const storagePercent = (storageUsed / storageTotal) * 100;
            const storageItem = document.getElementById('item.storage');
            if (storageItem) {
                const storageValue = storageItem.querySelector('h2');
                const storageProgress = storageItem.querySelector('.progress-fill');
                if (storageValue && !isNaN(storagePercent)) {
                    storageValue.textContent = `${storagePercent.toFixed(2)}%`;
                }
                if (storageProgress && !isNaN(storagePercent)) {
                    storageProgress.style.width = `${storagePercent}%`;
                }
            }

            // Update Network IPs
            if (data.lan_ip) {
                const lanIpEl = document.getElementById('lan-value');
                if (lanIpEl) lanIpEl.textContent = data.lan_ip;
            }
            if (data.internet_ip) {
                const localIpEl = document.getElementById('local-value');
                if (localIpEl) localIpEl.textContent = data.internet_ip;
            }
        }

        async function initMonitoring() {
            const data = await fetchServerStats();
            updateUI(data);

            setInterval(async () => {
                const data = await fetchServerStats();
                updateUI(data);
            }, 5000);
        }
        document.addEventListener('DOMContentLoaded', initMonitoring);
    </script>

</body>
</html>
